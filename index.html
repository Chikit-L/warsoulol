<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æˆ˜é­‚è§‰é†’OL</title>

  <style>
    /* ===== å…¨å±€èƒŒæ™¯è®¾ç½® ===== */
  body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      font-family: "Microsoft YaHei", sans-serif;
      color: #fff;
      background-color: #0b0b0b; /* é¡µé¢åº•è‰² */
      background-image: url('./assets/bg.png'); /* âœ… æ”¹æˆ PNG æ ¼å¼ */
      background-repeat: no-repeat;
      background-position: center center; /* å›¾æ¡ˆå±…ä¸­ */
      background-attachment: fixed;       /* ä¸éšæ»šåŠ¨ */
      background-size: auto;              /* ä¸æ‹‰ä¼¸ï¼Œä¸ç¼©æ”¾ */
      position: relative;
    }

    /* åŠé€æ˜é®ç½©å±‚ï¼Œè°ƒèŠ‚æ•´ä½“äº®åº¦ */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.3); /* é€æ˜åº¦è¶Šé«˜è¶Šæš—ï¼Œå¯è°ƒ 0.1~0.6 */
      z-index: -1;
    }

    /* å†…å®¹åŒºåŸŸæ ·å¼ */
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 2em;
      text-align: center;
    }

    h1 {
      font-size: 2.5em;
      margin-bottom: 0.2em;
    }

    h2 {
      font-size: 1.6em;
      margin-top: 1.2em;
      color: #ffd166;
    }

    .countdown {
      font-size: 1.4em;
      margin: 0.5em 0;
      color: #fff;
    }

    .hint {
      font-size: 0.9em;
      color: #ccc;
    }

    /* ===== å•†æˆ·ä»·æ ¼ç›‘æ§ ===== */
    .notice {
      margin-top: 2em;
      margin-bottom: 1.5em;
    }
    .notice-title {
      font-size: 1.6em;
      font-weight: 700;
      margin-bottom: 0.4em;
    }
    .notice-title a {
      color: #5cb6ff;
      text-decoration: underline;
      text-underline-offset: 4px;
    }
    .notice-title a:hover {
      color: #ffd166;
    }
    .notice-white {
      font-size: 0.95em;
      color: #ffffff;
      margin-top: 0.3em;
      margin-bottom: 0.8em;
    }
    .howto {
      font-size: 0.95em;
      color: #ddd;
      margin-top: 0;
    }

    /* ===== è¡¨æ ¼æ ·å¼ ===== */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1em;
      font-size: 0.95em;
    }

    th, td {
      border: 1px solid #555;
      padding: 8px;
    }

    th {
      background-color: rgba(255, 255, 255, 0.1);
      color: #ffd166;
    }

    a {
      color: #5cb6ff;
      text-decoration: underline;
    }

    a:hover {
      color: #ffd166;
    }

    footer {
      margin-top: 3em;
      font-size: 0.8em;
      color: #999;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>æ¬¢è¿æ¥åˆ° æˆ˜é­‚è§‰é†’OL</h1>
    <p><a href="https://aring.cc/awakening-of-war-soul-ol/" target="_blank">è¿›å…¥æ¸¸æˆ</a></p>

    <div class="card">
      <h2>å‰¯æœ¬åˆ·æ–°å€’è®¡æ—¶</h2>
      <p class="hint">ï¼ˆæ¯å‘¨æ—¥é›¶ç‚¹æ›´æ–°ï¼‰</p>
      <div id="weekly-countdown" class="countdown">-- å¤© -- å°æ—¶ -- åˆ†é’Ÿ -- ç§’é’Ÿ</div>
    </div>

    <div class="card">
      <h2>å¤§è’é‡åˆ·æ–°å€’è®¡æ—¶</h2>
      <p class="hint">ï¼ˆæ¯æœˆæœˆåˆé›¶ç‚¹åˆ·æ–°ï¼‰</p>
      <div id="monthly-countdown" class="countdown">-- å¤© -- å°æ—¶ -- åˆ†é’Ÿ -- ç§’é’Ÿ</div>
    </div>

    <!-- ğŸ†• å•†æˆ·ä»·æ ¼ç›‘æ§åŒº -->
    <section class="notice">
      <p class="notice-title">
        <a href="https://chikit-l.github.io/WarSoul_Monitor/" target="_blank" rel="noopener">
          å•†æˆ·ä»·æ ¼ç›‘æ§
        </a>
      </p>
      <p class="notice-white">
        ï¼ˆè¿™é‡Œå†™ä½ çš„ç™½å­—å†…å®¹ï¼Œä¾‹å¦‚ï¼šæœ¬é¡µé¢ä¸ºæˆ˜é­‚è§‰é†’ç³»åˆ—è¾…åŠ©å·¥å…·å±•ç¤ºå¹³å°ï¼‰
      </p>
      <p class="howto">
        æ³¨æ„ï¼šé¡µé¢æ‰€æä¾›ä¿¡æ¯ä»…ä¾›å‚è€ƒã€‚ç”±äº GitHub Actions æ›´æ–°å­˜åœ¨ä¸€å®šå»¶è¿Ÿï¼Œåœ¨é‡‡çº³ä¿¡æ¯æ—¶è¯·æ³¨æ„é¡µé¢çš„æ›´æ–°æ—¶é—´ã€‚
      </p>
    </section>

    <!-- ===== æ²¹çŒ´è„šæœ¬è¡¨æ ¼ ===== -->
    <section class="gm">
      <h2>æ²¹çŒ´è„šæœ¬</h2>
      <p class="howto">
        å¦‚ä½•ä½¿ç”¨ï¼Ÿ
        <a href="https://blog.csdn.net/qq_39201211/article/details/146199386" target="_blank" rel="noopener">ç‚¹å‡»æŸ¥çœ‹æ•™ç¨‹</a>
      </p>

      <table>
        <thead>
          <tr>
            <th>è„šæœ¬åç§°</th>
            <th>ç‰ˆæœ¬å·</th>
            <th>æ›´æ–°æ—¶é—´</th>
            <th>å®˜æ–¹å®‰è£…</th>
            <th>é•œåƒé“¾æ¥</th>
            <th>è¯´æ˜</th>
          </tr>
        </thead>
        <tbody id="script-rows">
          <tr><td colspan="6">åŠ è½½ä¸­...</td></tr>
        </tbody>
      </table>
    </section>

    <footer>
      <p>Â© <span id="year"></span> æˆ˜é­‚è§‰é†’OL | é¡µé¢æ•°æ®æ¥è‡ª GreasyFork</p>
    </footer>
  </div>

  <script>
    // === å€’è®¡æ—¶é€»è¾‘ ===
    const $ = (sel) => document.querySelector(sel);
    const weeklyEl = $("#weekly-countdown");
    const monthlyEl = $("#monthly-countdown");
    const yearEl = $("#year");
    yearEl.textContent = new Date().getFullYear();

    function nextSundayMidnight(now = new Date()) {
      const d = new Date(now);
      const day = d.getDay();
      const daysUntilSunday = (7 - day) % 7 || 7;
      const target = new Date(d.getFullYear(), d.getMonth(), d.getDate() + daysUntilSunday, 0, 0, 0, 0);
      return target;
    }

    function nextMonthFirstMidnight(now = new Date()) {
      const d = new Date(now);
      const target = new Date(d.getFullYear(), d.getMonth() + 1, 1, 0, 0, 0, 0);
      return target;
    }

    function fmt(ms) {
      if (ms <= 0) return { d: 0, h: 0, m: 0, s: 0 };
      const s = Math.floor(ms / 1000);
      const d = Math.floor(s / (3600 * 24));
      const h = Math.floor((s % (3600 * 24)) / 3600);
      const m = Math.floor((s % 3600) / 60);
      const sec = s % 60;
      return { d, h, m, s: sec };
    }

    function renderCountdown() {
      const now = new Date();
      const w = fmt(nextSundayMidnight(now) - now);
      const m = fmt(nextMonthFirstMidnight(now) - now);
      weeklyEl.textContent = `${w.d}å¤© ${w.h}å°æ—¶ ${w.m}åˆ†é’Ÿ ${w.s}ç§’é’Ÿ`;
      monthlyEl.textContent = `${m.d}å¤© ${m.h}å°æ—¶ ${m.m}åˆ†é’Ÿ ${m.s}ç§’é’Ÿ`;
    }
    setInterval(renderCountdown, 1000);
    renderCountdown();

    // === åŠ¨æ€åŠ è½½æ²¹çŒ´è„šæœ¬æ•°æ® ===
    async function loadScriptInfo() {
      try {
        const res = await fetch("./data/warsoul.json?t=" + Date.now());
        const data = await res.json();
        const items = Array.isArray(data.items) ? data.items : [];
        const rows = items.map(x => `
          <tr>
            <td><a href="${x.page}" target="_blank">${x.name}</a></td>
            <td>${x.version || '-'}</td>
            <td>${(x.updated_at || '-').slice(0, 10)}</td>
            <td><a href="${x.install_official}" target="_blank">ç‚¹å‡»å®‰è£…</a></td>
            <td><a href="${x.install_mirror}" target="_blank">ç‚¹å‡»å®‰è£…</a></td>
            <td>${x.desc || '-'}</td>
          </tr>`).join("");
        document.getElementById("script-rows").innerHTML = rows || `<tr><td colspan="6">æš‚æ— æ•°æ®</td></tr>`;
      } catch {
        document.getElementById("script-rows").innerHTML = `<tr><td colspan="6">æ— æ³•åŠ è½½ GreasyFork æ•°æ®</td></tr>`;
      }
    }
    loadScriptInfo();
  </script>
</body>
</html>
